var API_URL="https://content.guardianapis.com/",API_KEY="b2535bfe-c69b-44e5-8583-9d088cc11b21";$(document).ready(function(){$(".section-btn").on("click",function(a){sectionClick(this,a)});$("#searchButton").on("click",function(a){searchForArticle($("#searchBox").val(),$("#searchOrder").val())});$("#searchBox").focus(function(){$("#searchHelp").toggle(300)});$("#searchBox").blur(function(){$("#searchHelp").toggle(300)});getRecentArticles(void 0,20);getPopular(void 0,20)});
function sectionClick(a,c){$(a).parent().addClass("active").siblings().removeClass("active");var b=encodeURI(c.target.attributes[1].nodeValue);"home"==b?(getPopular(void 0,20),getRecentArticles(void 0,20)):(getPopular(b,20),getRecentArticles(b,20));displayArea("articleListings");b=$(a).text();"Home"==b&&(b="");$("#mostPopularTitle").text("Popular "+b+" Stories");$("#recentArticlesTitle").text("Recent "+b+" Stories")}
function displayArea(a){$("#articleListings").hide();$("#articleContent").hide();$("#searchResults").hide();"articleListings"==a?$("#articleListings").show():"articleContent"==a?$("#articleContent").show():"searchResults"==a&&$("#searchResults").show()}function remapClicks(){$(".article-link").off();$(".section-btn").off();$(".article-link").on("click",function(a){getArticle(a.target.id)});$(".section-btn").on("click",function(a){sectionClick(this,a)})}
function getArticle(a){$.getJSON(API_URL+a+"?show-blocks=all&api-key="+API_KEY,function(a){a=a.response.content;var b=a.webTitle,c=getArticleImageCaption(a),g=a.blocks.body["0"].bodyHtml,e=a.webUrl;a=makeDateReadable(a.webPublicationDate);var d=$(".active").find($(".nav-item").children()),f=d.text();d=d["0"].attributes[1].value;$("#articleContent").html('<button type="button" value="'+d+'"class="btn btn-primary btn-lg section-btn">'+f+"</button>");$("#articleContent").append("<h3>"+b+"</h3>");$("#articleContent").append("<h5>Published on "+
a+"</h5>");$("#articleContent").append(c);$("#articleContent").append(g);$("#articleContent").append("<a href='"+e+"'>Source Article </a>");remapClicks();displayArea("articleContent")})}
function getRecentArticles(a,c){var b=createURL(!1,a);void 0!=c&&(b=b+"&page-size="+String(c));$.getJSON(b,function(a){a=a.response.results;$("#recentArticlesListings").html(" ");for(var b in a){var c=a[b].webTitle,d=getImageFromData(a[b]);d='<img class="card-img-top  rounded mx-auto d-block article-link" href="#" id="'+a[b].id+'" src="'+d+'" width="100%" alt="Card image cap">';c='<h5 class="card-text"><a href="#" class="article-link" id="'+a[b].id+'">'+c+"  content.</a></h5></div></div></div>";$("#recentArticlesListings").append('<div class="col-3"><div class="card">'+
d+'<div class="card-body">'+c)}remapClicks()})}function getPopular(a,c){var b=createURL(!0,a);c&&(b=b+"&page-size="+String(c));$.getJSON(b,function(a){a=a.response.mostViewed;$("#popularListings").html("");var b=1,c;for(c in a)$("#popularListings").append('<hr><a class="article-link" href="#" id="'+a[c].id+'">'+b+": "+a[c].webTitle+"</a>"),b+=1;remapClicks()})}
function searchForArticle(a,c){var b=API_URL+"search?";""==a?$("#searchResults").html("<h4> No search query entered. Please refer to the help box for more information.</h4>"):(b=b+"q="+a+"&show-blocks=all&order-by="+c+"&api-key="+API_KEY,$.getJSON(b,function(b){$("#searchResults").html("<h4> Search Results for : "+a+"</h4><ul class='list-group'>");for(var c in b.response.results){var e=b.response.results[c],d=e.blocks.body["0"].bodyTextSummary,f="Published: "+makeDateReadable(e.webPublicationDate);
d=d.substring(0,120)+"...";$("#searchResults").append('<li class="list-group-item"><a href="#" class="article-link" id ="'+e.id+'" >'+b.response.results[c].webTitle+"</a><p>"+d+"</p><p>"+f+"</p> </li>")}$("#searchResults").append("</ul>");remapClicks()}));displayArea("searchResults")}
function createURL(a,c){if(1==a){var b="uk?";void 0!=c&&(b="uk/"+c+"?");b=API_URL+b+"show-most-viewed=true"}else b="search?",void 0!=c&&(b=b+"section="+c+"&"),b=API_URL+b+"order-by=newest&show-blocks=all";return b=b+"&api-key="+API_KEY}function makeDateReadable(a){return a.substring(0,10)+" at "+a.substring(11,19)}function getImageFromData(a){var c="images/news-placeholder.jpg";try{c=a.blocks.main.elements["0"].assets["0"].file}catch(b){}return c}
function getArticleImageCaption(a){var c="";try{c=a.blocks.main.bodyHtml}catch(b){c=a.blocks.body["0"].bodyHtml}return c};